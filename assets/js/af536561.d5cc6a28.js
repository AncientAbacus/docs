"use strict";(self.webpackChunkappcircle_docusaurus=self.webpackChunkappcircle_docusaurus||[]).push([[65466],{9439:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>m,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"workflows/common-workflow-steps/custom-script","title":"Custom Script","description":"Use Custom Script steps for additional functionalities in your builds.","source":"@site/docs/workflows/common-workflow-steps/custom-script.md","sourceDirName":"workflows/common-workflow-steps","slug":"/workflows/common-workflow-steps/custom-script","permalink":"/workflows/common-workflow-steps/custom-script","draft":false,"unlisted":false,"editUrl":"https://github.com/appcircleio/appcircle-docusaurus/tree/master/docs/workflows/common-workflow-steps/custom-script.md","tags":[{"inline":false,"label":"custom scripts","permalink":"/tags/custom-scripts","description":"Description for custom scripts"},{"inline":false,"label":"build","permalink":"/tags/build","description":"Description for build"},{"inline":false,"label":"test","permalink":"/tags/test","description":"Description for test"},{"inline":false,"label":"workflow","permalink":"/tags/workflow","description":"Description for workflow"},{"inline":false,"label":"step","permalink":"/tags/step","description":"Description for step"}],"version":"current","frontMatter":{"title":"Custom Script","description":"Use Custom Script steps for additional functionalities in your builds.","tags":["custom scripts","build","test","workflow","step"]},"sidebar":"mySidebar","previous":{"title":"How to Share Files Between Pipelines","permalink":"/workflows/common-workflow-steps/build-cache/how-to-share-file-between-pipelines"},"next":{"title":"Danger","permalink":"/workflows/common-workflow-steps/danger"}}');var i=t(74848),r=t(28453),o=t(11470),a=t(19365),l=t(69678);const c={title:"Custom Script",description:"Use Custom Script steps for additional functionalities in your builds.",tags:["custom scripts","build","test","workflow","step"]},d="Custom Script",h={},u=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"Input Variables",id:"input-variables",level:3},{value:"FAQ",id:"faq",level:2},{value:"How to change Java version",id:"how-to-change-java-version",level:3},{value:"How to install a new package to the build machine?",id:"how-to-install-a-new-package-to-the-build-machine",level:3},{value:"How to change the package name/application ID dynamically?",id:"how-to-change-the-package-nameapplication-id-dynamically",level:3},{value:"How to access a file in the repository directory?",id:"how-to-access-a-file-in-the-repository-directory",level:3},{value:"How to a add a file as a downloadable build artifact?",id:"how-to-a-add-a-file-as-a-downloadable-build-artifact",level:3},{value:"How to break pipeline on low test coverage",id:"how-to-break-pipeline-on-low-test-coverage",level:3},{value:"How to use environment variables along with the <code>sudo</code> command?",id:"how-to-use-environment-variables-along-with-the-sudo-command",level:3},{value:"How can I send a custom email?",id:"how-can-i-send-a-custom-email",level:3},{value:"How can I send the Appcircle build log to another platform?",id:"how-can-i-send-the-appcircle-build-log-to-another-platform",level:3},{value:"How can I print the status of workflow steps with detailed information?",id:"how-can-i-print-the-status-of-workflow-steps-with-detailed-information",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{ExternalUrlRef:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ExternalUrlRef",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"custom-script",children:"Custom Script"})}),"\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.strong,{children:"Custom Script"})," steps for additional functionalities in your builds. Appcircle will run the commands in your custom scripts and perform the specified actions. These scripts will be run on the runner and you can use any functionality of the build environment as you need."]}),"\n",(0,i.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.p,{children:["There are no prerequisites required before using the ",(0,i.jsx)(n.strong,{children:"Custom Script"})," step."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Note that you can put the ",(0,i.jsx)(n.strong,{children:"Custom Script"})," component anywhere you want in the workflow. This step is used to add different capabilities to the existing workflow."]})}),"\n",(0,i.jsx)(l.A,{url:"https://cdn.appcircle.io/docs/assets/BE2793-customScript.png"}),"\n",(0,i.jsx)(n.h3,{id:"input-variables",children:"Input Variables"}),"\n",(0,i.jsx)(n.p,{children:"This step contains some input variable(s). It needs these variable(s) to work. The table below gives explanation for this variable(s)."}),"\n",(0,i.jsx)(l.A,{url:"https://cdn.appcircle.io/docs/assets/BE2793-customInput.png"}),"\n",(0,i.jsxs)(n.admonition,{title:"Sensitive Variables",type:"danger",children:[(0,i.jsxs)(n.p,{children:["If you need to use sensitive variable in your script, please do not use these sensitive variables such as ",(0,i.jsx)(n.strong,{children:"Username"}),", ",(0,i.jsx)(n.strong,{children:"Password"}),", ",(0,i.jsx)(n.strong,{children:"API Key"}),", or ",(0,i.jsx)(n.strong,{children:"Personal Access Key"})," directly within the step."]}),(0,i.jsxs)(n.p,{children:["We recommend using ",(0,i.jsx)(n.a,{href:"/environment-variables/managing-variables",children:(0,i.jsx)(n.strong,{children:"Environment Variables"})})," groups for such sensitive variables."]})]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Variable Name"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Status"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Execute"})}),(0,i.jsxs)(n.td,{children:["You can run your script as ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Bash"})})," or ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Ruby"})})," with two different language environments in the ",(0,i.jsx)(n.strong,{children:"Execute With"})," input value."]}),(0,i.jsx)(n.td,{children:"Required"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Script"})}),(0,i.jsxs)(n.td,{children:["With the ",(0,i.jsx)(n.strong,{children:"Script"})," input variable, you can add the script you want to run and run it directly in the selected language. If you leave this input blank, it will proceed to the next step without taking any action."]}),(0,i.jsx)(n.td,{children:"Optional"})]})]})]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.p,{children:["Note that the ",(0,i.jsx)(n.strong,{children:"Script"})," area works according to the selected language variable. If you want to run a script in any language, make sure that you select the language correctly."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"To access the source code of this component, please use the following link:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://github.com/appcircleio/appcircle-custom-script-component",children:(0,i.jsx)(t,{url:"https://github.com/appcircleio/appcircle-custom-script-component",title:"GitHub - appcircleio/appcircle-custom-script-component",description:"Contribute to appcircleio/appcircle-custom-script-component development by creating an account on GitHub.",image:"https://opengraph.githubassets.com/12ed1bfc2e004ee8c9054075f1126a4d14f754f956636eb903a1fd7157762631/appcircleio/appcircle-custom-script-component"})})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(n.h3,{id:"how-to-change-java-version",children:"How to change Java version"}),"\n",(0,i.jsxs)(n.p,{children:["Appcircle currently has ",(0,i.jsx)(n.code,{children:"OpenJDK 17"})," (default), ",(0,i.jsx)(n.code,{children:"OpenJDK 8"}),", ",(0,i.jsx)(n.code,{children:"OpenJDK 11"})," and ",(0,i.jsx)(n.code,{children:"OpenJDK 21"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/workflows/android-specific-workflow-steps/android-build",children:"Android Build"})," step uses ",(0,i.jsx)(n.code,{children:"OpenJDK 17"})," as default JDK version."]}),"\n",(0,i.jsxs)(n.p,{children:["To switch JDK versions, you can now use the dedicated ",(0,i.jsx)(n.a,{href:"/workflows/common-workflow-steps/select-java-version",children:(0,i.jsx)(n.strong,{children:"Select Java Version"})})," component, so there is no need to use ",(0,i.jsx)(n.strong,{children:"Custom Script"})," for this task. For further details on this component, refer to the documentation:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/workflows/common-workflow-steps/select-java-version",children:"Select Java Version"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["However, if you prefer to update or improve it manually on ",(0,i.jsx)(n.strong,{children:"Custom Script"}),", the source code is available here:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/appcircleio/appcircle-select-java-version-component",children:"Select Java Version - Source Code"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-install-a-new-package-to-the-build-machine",children:"How to install a new package to the build machine?"}),"\n",(0,i.jsx)(n.p,{children:"You can use the compatible package managers to install packages."}),"\n",(0,i.jsxs)(n.p,{children:["For the macOS build machines for iOS builds, _brew _is a commonly used package manager with commands like ",(0,i.jsx)(n.code,{children:"brew install maven"})]}),"\n",(0,i.jsxs)(n.p,{children:["For the Linux (Debian) build machines for Android builds, ",(0,i.jsx)(n.em,{children:"apt-get"})," can be used for 3rd party packages such as ",(0,i.jsx)(n.code,{children:"apt-get -y install maven"})]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-change-the-package-nameapplication-id-dynamically",children:"How to change the package name/application ID dynamically?"}),"\n",(0,i.jsx)(n.p,{children:"With custom scripts, you can edit the Info.plist and the build.gradle files."}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"ios",label:"iOS",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="iOS sample for Info.plist"',children:'cd $AC_REPOSITORY_DIR/Your-Target-Folder\n/usr/libexec/PlistBuddy -c "Set :CFBundleIdentifier io.myapp" "./Info.plist"\n'})})}),(0,i.jsx)(a.A,{value:"android",label:"Android",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Android sample for build.gradle"',children:"cd $AC_REPOSITORY_DIR/app\nsed -i '' 's/old-value/new-value/g' build.gradle\n"})})})]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-access-a-file-in-the-repository-directory",children:"How to access a file in the repository directory?"}),"\n",(0,i.jsx)(n.p,{children:"For each step in the workflow, you can view the input and output variables in the step configuration."}),"\n",(0,i.jsxs)(n.p,{children:["The repository directory is an output of the Git Clone step and its patch can be accessed with the ",(0,i.jsx)(n.code,{children:"$AC_REPOSITORY_PATH"})," environment variable by any step added after the ",(0,i.jsx)(n.strong,{children:"Git Clone"})," step. An example is as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd $AC_REPOSITORY_DIR\ncat README\n"})}),"\n",(0,i.jsx)(n.h3,{id:"how-to-a-add-a-file-as-a-downloadable-build-artifact",children:"How to a add a file as a downloadable build artifact?"}),"\n",(0,i.jsxs)(n.p,{children:["You can add any file to the output directory that contain the build artifacts using the ",(0,i.jsx)(n.code,{children:"$AC_OUTPUT_DIR"})," environment variable. An example is as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd $AC_REPOSITORY_DIR/app/build/reports/\nmv lint-results* $AC_OUTPUT_DIR/\n"})}),"\n",(0,i.jsx)(n.h3,{id:"how-to-break-pipeline-on-low-test-coverage",children:"How to break pipeline on low test coverage"}),"\n",(0,i.jsx)(n.p,{children:"This document provides a sample custom script written in Ruby that can be integrated into your CI/CD pipeline to enforce a minimum test coverage threshold. The script is designed to break the pipeline if the covered test result falls below a specified percentage."}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsxs)(n.p,{children:["Please note that this custom script must be placed after the ",(0,i.jsx)(n.a,{href:"/continuous-testing/android-testing/running-android-unit-tests#generating-test-report",children:(0,i.jsx)(n.strong,{children:"Test Reports"})})," step in the workflow."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:'require \'json\'\n\ndef env_has_key(key)\n    !ENV[key].nil? && ENV[key] != \'\' ? ENV[key] : abort("Missing #{key}.")\nend\n\noutput_dir = env_has_key(\'AC_OUTPUT_DIR\')\n\ndef read_json_file(test_result_file_path)\n  JSON.parse(File.read(test_result_file_path))\nend\n\ndef extract_line_coverage(json_data)\n  json_data[\'coverage\'][\'lineCoverage\']\nend\n\nbegin\ntest_result_file_path = "#{output_dir}/test_results.json"\njson_data = read_json_file(test_result_file_path)\nline_coverage = extract_line_coverage(json_data)\n\nputs "Current Line Coverage: % #{line_coverage * 100}"\n\nmin_coverage = 2.0\nputs "Minimum coverage percentage: #{min_coverage}"\n\nif (line_coverage * 100) < min_coverage\n    puts "Coverage is #{line_coverage} and below minimum coverage percentage given #{min_coverage}. \\nExiting."\n    exit (1)\nelse\n    puts "Coverage is above the threshold. It is clear."\nend\n\nrescue StandardError => e\n  puts "An error occurred: #{e.message}"\nend\n'})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Please feel free to edit the following variables according to your own requirements:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"test_result_file_path"}),": The file path of the test result file from which to retrieve the covered percentage value."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"min_coverage"}),": The minimum percentage required for the pipeline to continue without breaking."]}),"\n"]})]}),"\n",(0,i.jsxs)(n.h3,{id:"how-to-use-environment-variables-along-with-the-sudo-command",children:["How to use environment variables along with the ",(0,i.jsx)(n.code,{children:"sudo"})," command?"]}),"\n",(0,i.jsxs)(n.p,{children:["Both user-created and Appcircle-reserved ",(0,i.jsx)(n.a,{href:"/environment-variables/managing-variables",children:"environment variables"})," can be used within a custom script with any required command. But, by default, commands that are triggered with ",(0,i.jsx)(n.code,{children:"sudo"}),"\xa0will not reach them since the user scope is changed."]}),"\n",(0,i.jsxs)(n.p,{children:["In order to use all user environment variables with ",(0,i.jsx)(n.code,{children:"sudo"}),", you should add the ",(0,i.jsx)(n.code,{children:"-E"})," argument to the ",(0,i.jsx)(n.code,{children:"sudo"})," command. The ",(0,i.jsx)(n.code,{children:"-E"})," (preserve environment) option indicates to the security policy that the user wishes to preserve their existing environment variables."]}),"\n",(0,i.jsx)(n.p,{children:"For instance, you can check the list of environment variables in the build pipeline using the command below."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo -E printenv\n"})}),"\n",(0,i.jsx)(n.h3,{id:"how-can-i-send-a-custom-email",children:"How can I send a custom email?"}),"\n",(0,i.jsxs)(n.p,{children:["Appcircle provides a ",(0,i.jsx)(n.strong,{children:"ready-to-use email"})," structure in the ",(0,i.jsx)(n.a,{href:"/testing-distribution/create-or-select-a-distribution-profile#share-binary",children:(0,i.jsx)(n.strong,{children:"Testing Distribution"})})," and ",(0,i.jsx)(n.a,{href:"/publish-integrations/common-publish-integrations/get-approval-via-email",children:(0,i.jsx)(n.strong,{children:"Publish"})})," modules. This structure varies across the two modules. If desired, the user can customize this structure by using the ",(0,i.jsx)(n.a,{href:"/workflows/common-workflow-steps/custom-script",children:(0,i.jsx)(n.strong,{children:"Custom Script"})})," below to send their own custom email."]}),"\n",(0,i.jsxs)(n.p,{children:["The following Bash script is set to use a ",(0,i.jsx)(n.strong,{children:"Gmail SMTP Server"}),". For more information, please visit ",(0,i.jsx)(n.a,{href:"https://support.google.com/a/answer/176600?hl=en",children:(0,i.jsx)(n.strong,{children:"Gmail SMTP Server"})})," documentation."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'\n# Set SMTP server \nCS_HOST="smtp.gmail.com"\nCS_PORT="587"\nCS_ACCOUNT="gmail"\n\n# Make sure to replace CS_EMAIL, CS_USERNAME, and CS_PASSWORD with your account details\nCS_EMAIL="your-email-address@gmail.com"\nCS_USERNAME="your-email-address@gmail.com"\nCS_PASSWORD="your-email-password"\n\n# Set email details\nCS_EMAIL_SUBJECT="Test Email Subject"\nCS_EMAIL_TO="recipient-address@mail.com,recipient-2-address@mail.com"\n# This part will be used for visualization\nCS_EMAIL_FROM="Sender Name <sender-address@gmail.com>"\nCS_EMAIL_BODY="This is the body of the sent email."\n# Set TLS and SSL usage\nCS_USE_TLS="True"\nCS_USE_SSL="False"\n\n# Detect operating system\nos=""\nif uname -a | grep -iq "darwin"; then\n    os="darwin"\nelif uname -a | grep -iq "linux"; then\n    os="linux"\nfi\n\n# Create the .msmtprc file with appropriate permissions\ncat <<EOF > ~/.msmtprc\ndefaults\nauth on\ntls on\nEOF\n\n# Check if OS is supported and install necessary packages\nif [ "$os" == "darwin" ]; then\n    if ! command -v brew > /dev/null 2>&1; then\n        echo "Can\'t find brew installation; make brew command visible or install homebrew and try again."\n        exit 1\n    fi\n    brew install mailutils\n    brew install msmtp\n    echo "set sendmail=/usr/local/bin/msmtp" | sudo tee -a /etc/mail.rc\n    { echo -n "tls_fingerprint " && msmtp --serverinfo --tls --tls-certcheck=off --host=$CS_HOST --port=$CS_PORT | egrep -o "([0-9A-Za-z]{2}:){31}[0-9A-Za-z]{2}"; } >> ~/.msmtprc\nelif [ "$os" == "linux" ]; then\n    if ! command -v apt > /dev/null 2>&1; then\n        echo "Apt is not installed; install apt and try again."\n        exit 1\n    fi\n    apt-get update\n    apt-get install -y mailutils msmtp msmtp-mta\n    echo "tls_trust_file /etc/ssl/certs/ca-certificates.crt" >> ~/.msmtprc\nelse\n    echo "Unsupported OS: $os. Darwin or Linux was expected."\n    exit 1\nfi\n\ncat <<EOF >> ~/.msmtprc\nlogfile ~/.msmtp.log\naccount $CS_ACCOUNT\nhost $CS_HOST\nport $CS_PORT\nfrom $CS_EMAIL\nuser $CS_USERNAME\npassword $CS_PASSWORD\naccount default: $CS_ACCOUNT\nEOF\n\n# Restrict permissions for the .msmtprc file to avoid security issues\nchmod 600 ~/.msmtprc\n\n# Cleanup .msmtprc whether script ends with success or failure\nfunction cleanup {\n  cat /dev/null > ~/.msmtprc\n}\ntrap cleanup EXIT\n\n# Send email\necho "From: $CS_EMAIL_FROM\nTo: $CS_EMAIL_TO\nSubject: $CS_EMAIL_SUBJECT\n$CS_EMAIL_BODY" | msmtp --debug --from=$CS_EMAIL -t $CS_EMAIL_TO\n\n'})}),"\n",(0,i.jsx)(n.admonition,{title:"Script Execution",type:"info",children:(0,i.jsxs)(n.p,{children:["This script is written in ",(0,i.jsx)(n.code,{children:"Bash"}),". When running with ",(0,i.jsx)(n.strong,{children:"Custom Script"}),", you need to set the ",(0,i.jsx)(n.code,{children:"Execute With"})," parameter as ",(0,i.jsx)(n.code,{children:"Bash"}),". For more information, please visit the ",(0,i.jsx)(n.a,{href:"/workflows/common-workflow-steps/custom-script#input-variables",children:(0,i.jsx)(n.strong,{children:"Custom Script Input Variables"})})," documentation section."]})}),"\n",(0,i.jsxs)(n.admonition,{title:"Input Variables",type:"note",children:[(0,i.jsxs)(n.p,{children:["When using your own SMTP server credentials for the three variables below, using ",(0,i.jsx)(n.strong,{children:"Environment Variables"})," is strongly suggested since this prevents sensitive information, such as passwords, from being exposed to unauthorized individuals."]}),(0,i.jsxs)(n.p,{children:["For more detailed information, please refer to the ",(0,i.jsx)(n.a,{href:"/environment-variables/managing-variables",children:(0,i.jsx)(n.strong,{children:"Environment Variables"})})," documentation."]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_EMAIL"}),": SMTP Server email address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_USERNAME"}),": Sender email address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_PASSWORD"}),": Sender email address password."]}),"\n"]}),(0,i.jsx)(n.p,{children:"Otherwise, to send an email, you need to have some information, such as the email subject, sender email, and recipient email. You can use these parameters to:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_EMAIL_SUBJECT"}),": Subject of sending email"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_EMAIL_TO"}),": Recipient email address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_EMAIL_FROM"}),": Sender email address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"$CS_EMAIL_BODY"}),": Content of sending email."]}),"\n"]})]}),"\n",(0,i.jsx)(n.admonition,{title:"Recipient Email Address",type:"tip",children:(0,i.jsxs)(n.p,{children:["If you want to send an email to multiple email addresses instead of a single email address, in the ",(0,i.jsx)(n.code,{children:"$CS_EMAIL_TO"})," parameter, it will be enough to write all the addresses to send an email separated by commas. For example, ",(0,i.jsx)(n.code,{children:"$CS_EMAIL_TO=example@email.com,example2@email.com"})]})}),"\n",(0,i.jsxs)(n.admonition,{title:"Sensitive Informations",type:"danger",children:[(0,i.jsxs)(n.p,{children:["Since the variables mentioned above, which need to be provided by the user, contain ",(0,i.jsx)(n.strong,{children:"sensitive"})," information like ",(0,i.jsx)(n.strong,{children:"passwords"}),", please use ",(0,i.jsx)(n.a,{href:"/environment-variables/managing-variables#adding-key-and-text-based-value-pairs",children:(0,i.jsx)(n.strong,{children:"Environment Variables"})})," for these types of values."]}),(0,i.jsxs)(n.p,{children:["To do this, comment out or remove the sensitive variables such as ",(0,i.jsx)(n.code,{children:"$CS_EMAIL"}),", ",(0,i.jsx)(n.code,{children:"$CS_USERNAME"}),", and ",(0,i.jsx)(n.code,{children:"$CS_PASSWORD"})," defined at the top of the script, and add them as environment variables instead."]}),(0,i.jsx)(n.p,{children:"For other variables that need to be defined, you can also make use of environment variables."})]}),"\n",(0,i.jsxs)(n.admonition,{title:"Self-hosted Runners",type:"caution",children:[(0,i.jsx)(n.p,{children:"If you're using self-hosted runners and they're not starting to build pipelines with clean states as in Appcircle Cloud, this custom script can be insecure to use since the consecutive pipelines are using the same build environment, and it might have last sent email sensitive configuration in some cases."}),(0,i.jsxs)(n.p,{children:["In order to send email, the script persists SMTP configuration to the\xa0",(0,i.jsx)(n.code,{children:"~/.msmtprc"}),' file. Although the script has a cleanup mechanism that works for success or failure cases, it cannot work on all conditions. For example, the "cancel build" case should be considered. In this case, the\xa0',(0,i.jsx)(n.code,{children:"~/.msmtprc"})," might not be cleaned, and it can be read in the next pipeline."]}),(0,i.jsx)(n.p,{children:"If you have configured runners similar to the Appcircle Cloud pools and they are wiped off after a build is executed to provide a fresh environment for every build, then there is nothing to consider; it's safe."})]}),"\n",(0,i.jsxs)(n.admonition,{title:"Username and Password for Google SMTP Users",type:"info",children:[(0,i.jsxs)(n.p,{children:["When you want to send an email with your Gmail account using ",(0,i.jsx)(n.strong,{children:"Google's SMTP"})," server, you must first ",(0,i.jsx)(n.strong,{children:"authenticate"})," to the Google SMTP server. For this process, you need to enter your ",(0,i.jsx)(n.strong,{children:"App Password"})," in the password field."]}),(0,i.jsxs)(n.p,{children:["In order to generate this password, ",(0,i.jsx)(n.strong,{children:"2FA authentication"})," must be turned on in your ",(0,i.jsx)(n.strong,{children:"Google account"}),". You can generate and retrieve this password from the ",(0,i.jsx)(n.strong,{children:"App Passwords"})," section under ",(0,i.jsx)(n.strong,{children:"Google Account management"}),". For detailed information about ",(0,i.jsx)(n.strong,{children:"App Passwords"}),", please visit the ",(0,i.jsx)(n.a,{href:"https://support.google.com/accounts/answer/185833?hl=en",children:(0,i.jsx)(n.strong,{children:"Google App Password"})})," documentation."]})]}),"\n",(0,i.jsxs)(n.admonition,{title:"Protocols and SMTP Host",type:"tip",children:[(0,i.jsxs)(n.p,{children:["This script uses the TLS protocol for SMTP server usage. Since the ",(0,i.jsx)(n.strong,{children:"Gmail SMTP"})," server is used in the script, the required protocols are pulled from ",(0,i.jsx)(n.strong,{children:"Google's SMTP"})," server using the ",(0,i.jsx)(n.code,{children:"$CS_HOST"})," parameter. If you are using your own SMTP server, don't forget to change the ",(0,i.jsx)(n.code,{children:"$CS_HOST"})," value here."]}),(0,i.jsxs)(n.p,{children:["On the other hand, to change ",(0,i.jsx)(n.strong,{children:"TLS or SSL"})," usage, you can change the protocol by setting the ",(0,i.jsx)(n.code,{children:"$CS_USE_TLS"})," or ",(0,i.jsx)(n.code,{children:"$CS_USE_SSL"})," parameters in the script to ",(0,i.jsx)(n.code,{children:"true"})," or ",(0,i.jsx)(n.code,{children:"false"}),". Note that you need to change the ",(0,i.jsx)(n.code,{children:"$CS_PORT"})," parameter when using ",(0,i.jsx)(n.strong,{children:"SSL"})," and ",(0,i.jsx)(n.strong,{children:"TLS"}),"."]}),(0,i.jsxs)(n.p,{children:["For more information about protocols, please visit the ",(0,i.jsx)(n.a,{href:"https://support.google.com/a/answer/100181",children:(0,i.jsx)(n.strong,{children:"Google's TLS and SSL"})})," documentation."]})]}),"\n",(0,i.jsx)(n.admonition,{title:"Sender Email and Spoofing",type:"danger",children:(0,i.jsx)(n.p,{children:"To use an SMTP server, this script first installs the necessary certificates, then authenticates to the server with the required credentials and sends the prepared email content to the recipient's email address. In order to change the sender's email address, the SMTP server must allow it by providing the necessary permissions. Otherwise, SMTP servers will send the email using the authenticated email address to prevent spoofing (impersonating someone else)."})}),"\n",(0,i.jsx)(n.h3,{id:"how-can-i-send-the-appcircle-build-log-to-another-platform",children:"How can I send the Appcircle build log to another platform?"}),"\n",(0,i.jsxs)(n.p,{children:["To send your build log to another platform using an API, you can access the log in your workflow through ",(0,i.jsx)(n.code,{children:"$AC_LOGFILE"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Here is an example using Dropbox's ",(0,i.jsx)(n.a,{href:"https://www.dropbox.com/developers/documentation/http/documentation#files-upload",children:"file-upload"})," API. Replace it with the appropriate API for your platform. If you are going to use DropBox, you can follow the document below to obtain the access token:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dropbox.tech/developers/generate-an-access-token-for-your-own-account",children:"Generate an access token for your own account"})}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"danger",children:[(0,i.jsx)(n.p,{children:"Ensure sensitive data, like access tokens, are defined as private environment variables. Learn more:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/environment-variables/managing-variables#adding-key-and-text-based-value-pairs",children:"Adding key and text-based value pairs"})}),"\n"]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'current_datetime=$(date +"%Y-%m-%d-%H-%M")\ndropbox_log_filename="/home/appcircle-logs/ac-log-$current_datetime.txt"\n\ncurl -X POST https://content.dropboxapi.com/2/files/upload \\\n    --header "Authorization: Bearer $DROPBOX_ACCESS_TOKEN" \\\n    --header "Dropbox-API-Arg: {\\"autorename\\":false,\\"mode\\":\\"add\\",\\"mute\\":false,\\"path\\":\\"$dropbox_log_filename\\",\\"strict_conflict\\":false}" \\\n    --header "Content-Type: application/octet-stream" \\\n    --data-binary @"$AC_LOGFILE"\n\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This script generates a timestamped log file (e.g., ",(0,i.jsx)(n.code,{children:"ac-log-2024-10-01-14-55.txt"}),") in the ",(0,i.jsx)(n.code,{children:"/home/appcircle-logs"})," in Dropbox."]}),"\n",(0,i.jsx)(l.A,{url:"https://cdn.appcircle.io/docs/assets/workflow-custom-script-faq-1.png"}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.p,{children:["Ensure that the ",(0,i.jsx)(n.strong,{children:"Custom Script"})," step runs after the ",(0,i.jsx)(n.a,{href:"/workflows/common-workflow-steps/export-build-artifacts",children:(0,i.jsx)(n.strong,{children:"Export Build Artifacts"})})," step to capture the full log."]})}),"\n",(0,i.jsx)(n.h3,{id:"how-can-i-print-the-status-of-workflow-steps-with-detailed-information",children:"How can I print the status of workflow steps with detailed information?"}),"\n",(0,i.jsx)(n.p,{children:"If you want to track or share the status of your workflow or individual steps during a build, you can use the following environment variables:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"$AC_BUILD_STATUS"})}),": Displays the running status of the workflow so far."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"$AC_BUILD_STEPS_STATUS"})}),": Displays detailed information about each executed step."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"runner"})," version must be ",(0,i.jsx)(n.strong,{children:"1.8.0 or later"})," to use the above two environment variables."]})}),"\n",(0,i.jsxs)(n.p,{children:["However, the output of ",(0,i.jsx)(n.code,{children:"$AC_BUILD_STEPS_STATUS"})," is in raw JSON format, which may not be easy to read directly. To make it more readable, you can use the following Ruby script to format and print the information in a user-friendly way:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ruby",children:"require 'json'\n\nputs \"AC_BUILD_STATUS: #{ENV['AC_BUILD_STATUS']}\"\n# Read the environment variable\njson_data = ENV['AC_BUILD_STEPS_STATUS']\n\nbegin\n  # Parse and beautify the JSON\n  parsed_data = JSON.parse(json_data)\n  pretty_json = JSON.pretty_generate(parsed_data)\n  \n  # Output the formatted JSON\n  puts \"AC_BUILD_STEPS_STATUS:\"\n  puts pretty_json\nrescue JSON::ParserError => e\n  puts \"Failed to parse JSON: #{e.message}\"\nend\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The script above is written in Ruby. To execute it, select ",(0,i.jsx)(n.code,{children:"Ruby"})," as the ",(0,i.jsx)(n.code,{children:"Execute with"})," option in the ",(0,i.jsx)(n.strong,{children:"Custom Script"})," step."]})}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsxs)(n.p,{children:["To ensure your script works even if one of the steps in the workflow fails (and you want to capture the failed status as well), enable the ",(0,i.jsx)(n.strong,{children:'"Always run this step even if the previous steps fail"'})," option."]}),(0,i.jsx)(l.A,{url:"https://cdn.appcircle.io/docs/assets/workflow-custom-script-faq-2.png"})]}),"\n",(0,i.jsxs)(n.p,{children:["If you add a ",(0,i.jsx)(n.strong,{children:"Custom Script"})," step with the code above after the ",(0,i.jsx)(n.strong,{children:"Git Clone"})," step in your workflow, the script will generate an output similar to this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'AC_BUILD_STATUS: Success\nAC_BUILD_STEPS_STATUS:\n[\n  {\n    "StepName": "Activate SSH Private Key",\n    "BuildStatus": "Success",\n    "Duration": 0.133102,\n    "StartDate": "2024-12-30T16:48:47.919386Z",\n    "FinishDate": "2024-12-30T16:48:48.052488Z"\n  },\n  {\n    "StepName": "Git Clone",\n    "BuildStatus": "Success",\n    "Duration": 1.90708,\n    "StartDate": "2024-12-30T16:48:48.186532Z",\n    "FinishDate": "2024-12-30T16:48:50.093612Z"\n  }\n]\n'})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsx)(n.p,{children:"Steps that are disabled in the workflow will not appear in the above output."})]}),"\n",(0,i.jsx)(n.p,{children:"Simply include this script in your workflow to better understand and monitor the status of your workflow steps."})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var s=t(18215);const i={tabItem:"tabItem_Ymn6"};var r=t(74848);function o(e){let{children:n,hidden:t,className:o}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(i.tabItem,o),hidden:t,children:n})}},11470:(e,n,t)=>{t.d(n,{A:()=>S});var s=t(96540),i=t(18215),r=t(23104),o=t(56347),a=t(205),l=t(57485),c=t(31682),d=t(70679);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:s,default:i}}=e;return{value:n,label:t,attributes:s,default:i}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const i=(0,o.W6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(r),(0,s.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,r=u(e),[o,l]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[c,h]=m({queryString:t,groupId:i}),[f,g]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[i,r]=(0,d.Dv)(t);return[i,(0,s.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:i}),x=(()=>{const e=c??f;return p({value:e,tabValues:r})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:o,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),g(e)}),[h,g,r]),tabValues:r}}var g=t(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=t(74848);function w(e){let{className:n,block:t,selectedValue:s,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),i=a[t].value;i!==s&&(c(n),o(i))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":t},n),children:a.map((e=>{let{value:n,label:t,attributes:r}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>l.push(e),onKeyDown:h,onClick:d,...r,className:(0,i.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":s===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:r}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function v(e){const n=f(e);return(0,j.jsxs)("div",{className:(0,i.A)("tabs-container",x.tabList),children:[(0,j.jsx)(w,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function S(e){const n=(0,g.A)();return(0,j.jsx)(v,{...e,children:h(e.children)},String(n))}},69678:(e,n,t)=>{t.d(n,{A:()=>i});t(96540);var s=t(74848);function i(e){let{url:n,alt:t}=e;return(0,s.jsx)("img",{className:"screenshot",src:n,alt:t||"Screenshot"})}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(96540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);